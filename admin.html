<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理画面</title>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2em;
      background-color: #f9f9f9;
      color: #333;
    }
    .container {
      max-width: 700px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 1em;
    }
    .section {
      background: white;
      padding: 1em;
      margin-bottom: 1.5em;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.1);
    }
    input, button {
      padding: 0.5em;
      margin: 0.5em 0;
    }
    ul {
      padding-left: 1.5em;
    }
    .hidden {
      display: none;
    }
    .log-entry {
      margin-bottom: 0.5em;
      padding-bottom: 0.5em;
      border-bottom: 1px solid #ddd;
    }
  </style>
</head>
<body>
  <div class="container">

    <div id="loginSection" class="section">
      <h2>管理者ログイン</h2>
      <input type="text" id="adminId" placeholder="ID"><br>
      <input type="password" id="adminPassword" placeholder="パスワード"><br>
      <button onclick="login()">ログイン</button>
      <p id="loginError" style="color: red;"></p>
    </div>

    <div id="adminPanel" class="section hidden">
      <h1>日程調整・管理画面</h1>

      <div>
        <h3>候補日を追加</h3>
        <input type="text" id="newDate" placeholder="例: 2025-06-15 14:00">
        <button onclick="addDate()">追加</button>
      </div>

      <div>
        <h3>既存の候補日</h3>
        <ul id="dateList"></ul>
      </div>

      <div>
        <h3>変更ログ</h3>
        <button onclick="fetchLogs()">ログを再読み込み</button>
        <div id="logList"></div>
      </div>
    </div>

  </div>

  <script>
    // Firebase 初期化
    const firebaseConfig = {
  apiKey: "AIzaSyBzYCHcumBzRw3DLs8mjLiGTiXxvxmjLDU",
  authDomain: "unsoleinight-schedule.firebaseapp.com",
  projectId: "unsoleinight-schedule",
  storageBucket: "unsoleinight-schedule.firebasestorage.app",
  messagingSenderId: "1040333692698",
  appId: "1:1040333692698:web:fb0e4f481dff8167f756a3"
};
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 固定ログイン情報（開発用）
    const FIXED_ID = "admin";
    const FIXED_PASSWORD = "password123";

    function login() {
      const inputId = document.getElementById("adminId").value;
      const inputPassword = document.getElementById("adminPassword").value;
      if (inputId === FIXED_ID && inputPassword === FIXED_PASSWORD) {
        document.getElementById("loginSection").classList.add("hidden");
        document.getElementById("adminPanel").classList.remove("hidden");
        loadDates();
        fetchLogs();
      } else {
        document.getElementById("loginError").textContent = "IDまたはパスワードが間違っています";
      }
    }

    async function loadDates() {
      const list = document.getElementById("dateList");
      list.innerHTML = "";
      const snapshot = await db.collection("dates").orderBy("value").get();
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.textContent = doc.id;
        const btn = document.createElement("button");
        btn.textContent = "削除";
        btn.onclick = () => removeDate(doc.id);
        li.appendChild(btn);
        list.appendChild(li);
      });
    }

    async function addDate() {
      const newDate = document.getElementById("newDate").value.trim();
      if (!newDate) return alert("日付を入力してください");
      await db.collection("dates").doc(newDate).set({ value: newDate });
      await db.collection("logs").add({
        timestamp: new Date(),
        action: "追加",
        date: newDate,
        actor: "admin"
      });
      document.getElementById("newDate").value = "";
      loadDates();
      fetchLogs();
    }

    async function removeDate(date) {
      if (!confirm(`${date} を削除しますか？`)) return;
      await db.collection("dates").doc(date).delete();
      await db.collection("logs").add({
        timestamp: new Date(),
        action: "削除",
        date: date,
        actor: "admin"
      });
      loadDates();
      fetchLogs();
    }

    async function fetchLogs() {
      const container = document.getElementById("logList");
      container.innerHTML = "";
      const snapshot = await db.collection("logs").orderBy("timestamp", "desc").limit(50).get();
      snapshot.forEach(doc => {
        const log = doc.data();
        const div = document.createElement("div");
        div.classList.add("log-entry");
        const date = log.timestamp.toDate().toLocaleString();
        div.textContent = `[${date}] ${log.actor} が「${log.date}」を ${log.action}`;
        container.appendChild(div);
      });
    }
  </script>
</body>
</html>
